<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Submit Question</title>
    <link href="styles.css" rel="stylesheet">
</head>

<body>
    <h1>Submit a Question</h1>
    <form id="submitForm" onsubmit="submitQuestion(event)">
        <label for="questionText">Question:</label>
        <input id="questionText" type="text" required>

        <label>Answers:</label>
        <div id="answers">
            <div>
                <input type="text" class="answer" required>
                <label><input type="checkbox" class="correct-checkbox"> Correct</label>
            </div>
            <div>
                <input type="text" class="answer" required>
                <label><input type="checkbox" class="correct-checkbox"> Correct</label>
            </div>
            <div>
                <input type="text" class="answer" required>
                <label><input type="checkbox" class="correct-checkbox"> Correct</label>
            </div>
            <div>
                <input type="text" class="answer" required>
                <label><input type="checkbox" class="correct-checkbox"> Correct</label>
            </div>
        </div>

        <label for="category">Category:</label>
        <select id="category"></select>
        <label for="newCategory">New Category (optional):</label>
        <input id="newCategory" type="text">

        <button type="submit">Submit</button>
    </form>

    <script>
        async function fetchCategories()
        {
            try
            {
                const response = await fetch('http://localhost:4200/categories'); // Updated port number
                const data = await response.json();
                const categoryDropdown = document.getElementById('category');
                categoryDropdown.innerHTML = '<option value="">Select a category</option>';

                data.forEach(category =>
                {
                    const option = document.createElement('option');
                    option.value = category;
                    option.textContent = category;
                    categoryDropdown.appendChild(option);
                });
            } catch (error)
            {
                console.error('Error fetching categories:', error);
            }
        }

        function submitQuestion(event)
        {
            event.preventDefault();

            const question = document.getElementById('questionText').value;
            const answerInputs = document.querySelectorAll('.answer');
            const correctCheckboxes = document.querySelectorAll('.correct-checkbox');

            const answers = Array.from(answerInputs).map((input, index) => ({
                text: input.value,
                isCorrect: correctCheckboxes[index].checked
            }));

            const correctCount = answers.filter(ans => ans.isCorrect).length;
            if (correctCount !== 1)
            {
                alert('Please select exactly one correct answer.');
                return;
            }

            const category = document.getElementById('category').value;
            const newCategory = document.getElementById('newCategory').value.trim();

            fetch('http://localhost:4200/submit', { // Updated port number
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ question, answers, category, newCategory })
            })
                .then(response => response.json())
                .then(data =>
                {
                    alert(data.message || 'Question submitted successfully!');
                    document.getElementById('submitForm').reset();
                })
                .catch(error => console.error('Error submitting question:', error));
        }

        // Populate categories on page load
        window.onload = fetchCategories;
    </script>
</body>

</html>